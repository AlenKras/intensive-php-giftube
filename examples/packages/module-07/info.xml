<?xml version="1.0" encoding="utf-8" ?>
<examples>
  <example name="Счетчик посещений" index="1">
    <description>
      Сделаем простой счетчик, который будет показывать сколько раз пользователь загружал эту страницу.
      Для хранения числа визитов используем куки, а затем сессию.
    </description>
    <files>
      <file name="cookie.php" main="true" show="true">
        <intro order="1">Сделаем простой счетчик, который будет показывать сколько раз пользователь загружал эту страницу.
          Для хранения числа визитов используем куки, а затем сессию.
        </intro>
        <states>
          <state order="2">Определимся как будет называться наша кука для хранения счетчика</state>
          <state order="3">Установим начальное значение счетчика - одно посещение</state>
          <state order="4">Кука будет жить ровно 30 дней. Функция strtotime переводит дату в TIMESTAMP формат</state>
          <state order="5">Путь на сайте, по которому будет доступна кука. Слеш означает весь сайт</state>
          <state order="6">Проверяем существование куки с этим именем. Если кука существует, то получаем её значение
            в переменную и увеличиваем это значение на единицу.
          </state>
          <state order="7">Устанавливаем куку с помощью функции setcookie. Эта функция создаст новую куку, или
            обновит значение существующей.
          </state>
          <state order="8" reload="true">Посмотрим что у нас получилось! Выведем значение счетчика на страницу.</state>
        </states>
      </file>
      <file name="session.php" show="true" main="false">
        <intro order="9">Точно такой же счетчик можно сделать из без использования cookies.
          Хранить информацию между запросами также умеют PHP-сессии.
        </intro>
        <states>
          <state order="10">Если в сценарии мы собираемся работать с сессиями, то очень важно не забывать вызвать в
            начале функцию session_start(). Эта функция подготовливает сессии к работе.
          </state>
          <state order="11">Проверяем существование сессии с именем visit_count. Если такая сессия существует, то
            получаем её значение и прибавляем к нему единицу.
          </state>
          <state order="12" reload="true">Записываем новое значение счетчика обратно в сессию и показываем его на
            экране
          </state>
        </states>
      </file>
    </files>
  </example>
  <example name="Аутентификация" index="2">
    <description>
      Сделаем форму входа на сайт. Научимся проверять пароль пользователя и выполнять аутентификацию.
    </description>
    files
    <files>
      <file name="enter.php" main="true" show="true">
        <intro order="1">Сделаем форму входа на сайт. Научимся проверять пароль пользователя и выполнять
          аутентификацию.</intro>
        <states>
          <state order="5">Проверяем, что форма была отправлена</state>
          <state order="6">Определяем обязательные для заполнения поля, а также массив,
            где будут храниться ошибки
          </state>
          <state order="7">Проверяем все поля на заполненность</state>
          <state order="8">Найдем в таблице users пользователя с переданным
            email.
          </state>
          <state order="9">Проверяем, что сохраненный хеш пароля и введенный пароль из формы совпадают. Если совпадение
            есть, значит пользователь указал верный пароль. Тогда мы можем открыть для него сессию и записать
            в неё все данные о пользователе
          </state>
          <state order="10">В противном случае пароль неверный и мы добавляем сообщение об этом в список ошибок</state>
          <state order="11">Если пользователь не найден, то записываем это как ошибку валидации
          </state>
          <state order="12">Если были ошибки, значит мы снова должны показать форму входа, передав в шаблон список
            полученных ошибок
          </state>
          <state order="14">Если ошибок нет, значит аутентификация прошла успешно и пользователя можно
            перенаправить на главную страницу
          </state>
          <state order="16">Если форма не была отправлена, то проверяем существование сессии с пользователем.
            Сессия есть - значит пользователь залогинен и ему можно показать страницу приветствия.
            Сессии нет - показываем форму для входа на сайт.
          </state>
          <state order="17" reload="true">Подключаем лейаут и выводим его на экран</state>
        </states>
      </file>
      <file name="templates/enter.php" show="true" main="false">
        <intro order="13">Шаблон формы входа. Здесь предусмотрено выделение ошибочно заполненных полей -
        это необходимая часть валидации.</intro>
        <states/>
      </file>
      <file name="templates/welcome.php" show="true" main="false">
        <intro order="15">Этот очень простой шаблон нужен лишь для демонстрации работы аутентификации. </intro>
        Пользователь перенаправляется сюда после формы входа. Здесь мы показываем его логин, который
        предварительно был получен из сессии.
        <states/>
      </file>
      <file name="templates/layout.php" show="false" main="false">
        <states/>
      </file>
    </files>
  </example>
  <example name="Регистрация пользователя" index="3">
    <description>to do</description>
    <files>
      <file name="register.php" main="true" show="true">
        <intro order="1">Сделаем страницу для регистрации, где пользователь сможет завести себе аккаунт на нашем сайте.</intro>
        <states>
          <state order="2">Проверим существование пользователя с email из формы. Для этого выполним запрос на
          поиск записи в таблице пользователей по переданному email.</state>
          <state order="3">Если запрос вернул больше нуля записей, значит такой поьзователь уже существует.</state>
          <state order="4">Добавим нового пользователя в БД. Чтобы не хранить пароль в открытом виде преобразуем его
          в хеш.</state>
          <state order="5">Редирект на страницу входа, если пользователь был успешно добавлен в БД.</state>
          <state order="6">Передадим в шаблон список ошибок и данные из формы</state>
        </states>
      </file>
      <file name="templates/reg.php" main="false" show="true">
        <intro order="7">Шаблон с формой регистрации</intro>
        <states>
        </states>
      </file>
    </files>
  </example>
</examples>